<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª | Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</title>
    <style>
        :root {
            --primary: #004a99;
            --secondary: #008c45;
            --bg: #f8f9fa;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            text-align: center;
            border-top: 5px solid var(--primary);
        }
        .logo-placeholder {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
        }
        h2 { margin-bottom: 10px; color: #333; }
        p { color: #666; margin-bottom: 25px; font-size: 14px; }
        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            text-align: center;
            transition: 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; }
        button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        button:hover { background: #003366; }
        #status { margin-top: 20px; font-size: 15px; min-height: 25px; font-weight: 500; }
        .error { color: #d9534f; }
        .success { color: var(--secondary); }
        .loading { color: #f0ad4e; }
    </style>
</head>
<body>

<div class="card">
    <div class="logo-placeholder">RCJY ğŸ“</div>
    <h2>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
    <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯ØªÙƒ (Ø¯ÙˆØ±Ø© Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©)</p>
    
    <input type="text" id="studentId" placeholder="461XXXXXX" maxlength="9">
    <button id="searchBtn" onclick="downloadCertificate()">Ø¨Ø­Ø« ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
    
    <div id="status"></div>
</div>

<script>
    const cloudflareBaseUrl = "https://silent-limit-b55b.mohammed-rasasi.workers.dev/";

    async function downloadCertificate() {
        const idInput = document.getElementById('studentId');
        const status = document.getElementById('status');
        const btn = document.getElementById('searchBtn');
        const id = idInput.value.trim();

        // 1. ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        if (id.length !== 9 || isNaN(id)) {
            status.innerHTML = '<span class="error">âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ØµØ­ÙŠØ­ (9 Ø£Ø±Ù‚Ø§Ù…)</span>';
            return;
        }

        // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«"
        status.innerHTML = '<span class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø´Ù‡Ø§Ø¯ØªÙƒ...</span>';
        btn.disabled = true; // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹

        const fileUrl = `${cloudflareBaseUrl}${id}.pdf`;

        try {
            // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù
            const response = await fetch(fileUrl, { method: 'HEAD' });

            if (response.ok) {
                status.innerHTML = '<span class="success">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>';
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                const link = document.createElement('a');
                link.href = fileUrl;
                link.setAttribute('download', `Certificate_${id}.pdf`);
                document.body.appendChild(link);
                link.click();
                link.remove();
            } else {
                // ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ 404 Ø£Ùˆ ØºÙŠØ±Ù‡
                status.innerHTML = '<span class="error">âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ù‡Ø§Ø¯Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ.</span>';
            }
        } catch (error) {
            // ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ CORS Ø£Ùˆ Ø§Ù„Ø´Ø¨ÙƒØ©ØŒ Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙƒØ­Ù„ Ø£Ø®ÙŠØ±
            console.log("Network check failed, trying direct link...");
            status.innerHTML = '<span class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...</span>';
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ù„Ù
            setTimeout(() => {
                window.location.href = fileUrl;
                status.innerHTML = '<span class="success">ğŸš€ ØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.</span>';
            }, 1000);
        } finally {
            btn.disabled = false; // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
        }
    }
</script>

</body>
</html>
