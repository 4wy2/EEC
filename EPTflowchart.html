<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>EE Degree Plan - Progress Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #050810;
      --card-bg: rgba(15, 23, 42, 0.8);
      --card-border: rgba(255, 255, 255, 0.1);
      --text-main: #f1f5f9;
      --text-muted: #64748b;
      --accent-blue: #38bdf8;
      --accent-yellow: #fbbf24;
      --accent-green: #22c55e;
      --card-width: 135px; /* تثبيت العرض لمنع "التمطيط" في الجوال */
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg-dark);
      color: var(--text-main);
      font-family: 'Cairo', sans-serif;
      overflow: hidden; 
      height: 100vh;
      width: 100vw;
      touch-action: none;
    }

    header {
      padding: 15px;
      text-align: center;
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(5, 8, 16, 0.95);
      backdrop-filter: blur(10px);
      z-index: 2000;
      border-bottom: 1px solid var(--card-border);
    }

    header h2 {
      margin: 0;
      font-weight: 900;
      letter-spacing: 2px;
      color: #fff;
      font-size: clamp(0.9rem, 4vw, 1.5rem);
    }

    .legend {
      display: inline-flex;
      gap: 15px;
      font-size: 0.75rem;
      margin-top: 8px;
    }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    .dot { width: 8px; height: 8px; border-radius: 2px; }

    .viewport {
      width: 100vw;
      height: 100vh;
      cursor: grab;
      position: relative;
      overflow: hidden;
    }

    /* هذا القسم هو المسؤول عن بقاء الجدول مرتباً في الجوال */
    .flowchart-wrapper {
      position: absolute;
      transform-origin: center center; 
      padding: 400px;
      display: inline-flex; /* يمنع انكماش العناصر */
      flex-direction: column;
      min-width: 1400px; /* ضمان عرض ثابت لجميع الأجهزة */
      will-change: transform;
    }

    .year-section {
      display: flex;
      margin-bottom: 80px;
      position: relative;
      padding-bottom: 75px;
    }

    .year-section::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 80px;
      right: 40px;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1) 20%, rgba(255, 255, 255, 0.1) 80%, transparent);
    }

    .year-sidebar {
      width: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-right: 3px solid #333;
      flex-shrink: 0;
    }
    .year-label {
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      font-weight: 900;
      letter-spacing: 5px;
      font-size: 1.1rem;
    }

    .semesters-container {
      display: flex;
      flex-direction: column;
      gap: 70px; 
    }

    .semester-row { 
      display: flex; 
      align-items: center; 
      padding-left: 30px; 
    }

    .sem-indicator {
      width: 90px;
      font-size: 0.7rem;
      font-weight: 800;
      color: var(--text-muted);
      border-left: 2px solid rgba(255,255,255,0.05);
      padding-left: 12px;
      flex-shrink: 0;
    }

    .course-list { 
      display: flex; 
      gap: 45px; /* الحفاظ على نفس المسافة في اللابتوب والجوال */
    }

    .card {
      width: var(--card-width);
      height: 85px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
      z-index: 10;
      transition: transform 0.2s;
      cursor: pointer;
    }
    
    .card.completed {
      border-color: var(--accent-green) !important;
      background: rgba(34, 197, 94, 0.15) !important;
    }
    .card.completed::after {
      content: '✓';
      position: absolute;
      top: 4px; right: 6px;
      color: var(--accent-green);
      font-size: 12px;
    }

    .code { font-family: 'JetBrains Mono'; font-size: 0.8rem; color: var(--accent-blue); font-weight: 800; }
    .name { font-size: 0.58rem; color: #cbd5e1; margin-top: 4px; padding: 0 5px; line-height: 1.2; }

    #svg-canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }

    .zoom-controls {
      position: fixed;
      bottom: 25px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 3000;
    }
    
    .zoom-btn {
      width: 45px; height: 45px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: rgba(15, 23, 42, 0.9);
      color: white;
      font-size: 20px;
      backdrop-filter: blur(5px);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

<header id="main-header">
  <h2>ELECTRICAL ENGINEERING STUDY PLAN</h2>
  <div style="font-size: 0.8rem; color: #38bdf8; font-weight: 600;">Designed & Developed by AL-RASSASI</div>
  <div class="legend">
    <div class="legend-item"><div class="dot" style="background:var(--accent-blue)"></div> Prerequisite</div>
    <div class="legend-item"><div class="dot" style="background:var(--accent-yellow)"></div> Co-requisite</div>
    <div class="legend-item"><div class="dot" style="background:var(--accent-green)"></div> Completed</div>
  </div>
</header>

<div class="zoom-controls">
  <button class="zoom-btn" onclick="manualZoom(1.15)">+</button>
  <button class="zoom-btn" onclick="manualZoom(0.85)">-</button>
  <button class="zoom-btn" onclick="resetView()" style="font-size: 10px; font-weight: 900;">RESET</button>
</div>

<div class="viewport" id="viewport">
  <div class="flowchart-wrapper" id="main-wrapper">
    <svg id="svg-canvas"></svg>

    <div class="year-section">
      <div class="year-sidebar"><span class="year-label" style="color:var(--text-main);">YEAR 1</span></div>
      <div class="semesters-container">
        <div class="semester-row">
          <div class="sem-indicator">SEM 1</div>
          <div class="course-list">
            <div class="card" id="ENG101"><div class="code">ENG 101</div><div class="name">English Communication</div></div>
            <div class="card" id="GSMA101"><div class="code">GSMA 101</div><div class="name">Calculus I</div></div>
            <div class="card" id="GSPH101"><div class="code">GSPH 101</div><div class="name">General Physics</div></div>
            <div class="card" id="GSPE101"><div class="code">GSPE 101</div><div class="name">Physical Education I</div></div>
            <div class="card" id="ELET101"><div class="code">ELET 101</div><div class="name">Electrical Circuits I</div></div>
            <div class="card" id="ELET104"><div class="code">ELET 104</div><div class="name">Computer Programming</div></div>
          </div>
        </div>
        <div class="semester-row">
          <div class="sem-indicator">SEM 2</div>
          <div class="course-list">
            <div class="card" id="GSCH101"><div class="code">GSCH 101</div><div class="name">General Chemistry</div></div>
            <div class="card" id="GSMA102"><div class="code">GSMA 102</div><div class="name">Calculus II</div></div>
            <div class="card" id="ENG102"><div class="code">ENG 102</div><div class="name">English Composition</div></div>
            <div class="card" id="ELET102"><div class="code">ELET 102</div><div class="name">Electrical Circuits II</div></div>
            <div class="card" id="ELET103"><div class="code">ELET 103</div><div class="name">Electrical Machines I</div></div>
            <div class="card" id="ELET105"><div class="code">ELET 105</div><div class="name">Electronics I</div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="year-section">
      <div class="year-sidebar"><span class="year-label" style="color:var(--accent-blue);">YEAR 2</span></div>
      <div class="semesters-container">
        <div class="semester-row">
          <div class="sem-indicator">SEM 3</div>
          <div class="course-list">
            <div class="card" id="GSST201"><div class="code">GSST 201</div><div class="name">Applied Statistics</div></div>
            <div class="card" id="ENGT201"><div class="code">ENGT 201</div><div class="name">Industrial Safety</div></div>
            <div class="card" id="ELET201"><div class="code">ELET 201</div><div class="name">Basic Industrial Electronics</div></div>
            <div class="card" id="ELET202"><div class="code">ELET 202</div><div class="name">Digital Electronics I</div></div>
            <div class="card" id="ELET203"><div class="code">ELET 203</div><div class="name">Control System Components</div></div>
            <div class="card" id="ELET221"><div class="code">ELET 221</div><div class="name">Electrical Installations</div></div>
            <div class="card" id="ELET222"><div class="code">ELET 222</div><div class="name">Electrical Machines II</div></div>
          </div>
        </div>
        <div class="semester-row">
          <div class="sem-indicator">SEM 4</div>
          <div class="course-list">
            <div class="card" id="GSIS101"><div class="code">GSIS 101</div><div class="name">Islamic Ideology</div></div>
            <div class="card" id="ENG201"><div class="code">ENG 201</div><div class="name">Technical Report Writing</div></div>
            <div class="card" id="ENGT202"><div class="code">ENGT 202</div><div class="name">Industrial Supervision</div></div>
            <div class="card" id="ELET223"><div class="code">ELET 223</div><div class="name">Electrical Motor Control</div></div>
            <div class="card" id="ELET224"><div class="code">ELET 224</div><div class="name">Electrical Power Systems</div></div>
            <div class="card" id="ELET225"><div class="code">ELET 225</div><div class="name">Electrical Trbl Shtg & Maint</div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="year-section">
      <div class="year-sidebar"><span class="year-label" style="color:var(--accent-green);">CO-OP</span></div>
      <div class="semesters-container">
        <div class="semester-row">
          <div class="sem-indicator">TRAINING</div>
          <div class="course-list">
            <div class="card" id="ELET320" style="width: 250px;">
              <div class="code">ELET 320</div>
              <div class="name">Co-op Training (14 Weeks)</div>
              <div style="font-size: 0.5rem; color: var(--accent-yellow); margin-top: 4px;">Requires 67 Credit Hours</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const wrapper = document.getElementById('main-wrapper');
const viewport = document.getElementById('viewport');
const svg = document.getElementById('svg-canvas');
const header = document.getElementById('main-header');

let scale = 0.3; // سكيل افتراضي أصغر للجوال
let translateX = 0;
let translateY = 0;
let isDragging = false;
let startX, startY;

const connections = [
  { from: 'GSMA101', to: 'GSMA102', type: 'pre' },
  { from: 'ENG101',  to: 'ENG102',  type: 'pre' },
  { from: 'GSPH101', to: 'ELET101', type: 'co'  },
  { from: 'ELET101', to: 'ELET102', type: 'pre' },
  { from: 'ELET101', to: 'ELET103', type: 'pre' },
  { from: 'ELET102', to: 'ELET103', type: 'co'  },
  { from: 'ELET101', to: 'ELET105', type: 'pre' },
  { from: 'ELET102', to: 'ELET105', type: 'co'  },
  { from: 'GSMA102', to: 'GSST201', type: 'pre' },
  { from: 'ENG102',  to: 'ENGT201', type: 'pre' },
  { from: 'ELET105', to: 'ELET201', type: 'pre' },
  { from: 'ELET105', to: 'ELET202', type: 'pre' },
  { from: 'GSMA102', to: 'ELET203', type: 'pre' },
  { from: 'ELET102', to: 'ELET221', type: 'pre' },
  { from: 'ELET103', to: 'ELET222', type: 'pre' },
  { from: 'ENG102',  to: 'ENG201',  type: 'pre' },
  { from: 'ENG102',  to: 'ENGT202', type: 'pre' },
  { from: 'ELET201', to: 'ELET223', type: 'pre' },
  { from: 'ELET203', to: 'ELET223', type: 'pre' },
  { from: 'ELET222', to: 'ELET223', type: 'pre' },
  { from: 'ELET222', to: 'ELET224', type: 'pre' },
  { from: 'ELET222', to: 'ELET225', type: 'pre' },
  { from: 'ELET223', to: 'ELET225', type: 'co'  },
  { from: 'ELET224', to: 'ELET225', type: 'co'  }
];

function updateTransform() {
    const vW = viewport.clientWidth;
    const vH = viewport.clientHeight;
    const hH = header.offsetHeight;
    const rect = wrapper.getBoundingClientRect();

    // قيود ذكية تمنع الضياع
    const xLim = (rect.width / 2) + (vW / 2) - 100;
    const yTop = (rect.height / 2) - (vH / 2) + hH + 10;
    const yBot = (rect.height / 2) + (vH / 2) - 100;

    translateX = Math.min(Math.max(translateX, -xLim), xLim);
    translateY = Math.max(Math.min(translateY, yBot), -yTop);

    wrapper.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
}

// السحب (ماوس + لمس)
function startDrag(x, y) { isDragging = true; startX = x - translateX; startY = y - translateY; }
function moveDrag(x, y) { if (!isDragging) return; translateX = x - startX; translateY = y - startY; updateTransform(); }

viewport.addEventListener('mousedown', e => startDrag(e.clientX, e.clientY));
window.addEventListener('mousemove', e => moveDrag(e.clientX, e.clientY));
window.addEventListener('mouseup', () => isDragging = false);

viewport.addEventListener('touchstart', e => { if(e.touches.length === 1) startDrag(e.touches[0].clientX, e.touches[0].clientY); }, {passive: false});
viewport.addEventListener('touchmove', e => { if(e.touches.length === 1) { moveDrag(e.touches[0].clientX, e.touches[0].clientY); e.preventDefault(); } }, {passive: false});
viewport.addEventListener('touchend', () => isDragging = false);

// الزوم
viewport.addEventListener('wheel', e => { e.preventDefault(); scale = Math.min(Math.max(0.2, scale * (e.deltaY > 0 ? 0.9 : 1.1)), 2); updateTransform(); }, {passive: false});

function manualZoom(f) { scale = Math.min(Math.max(0.2, scale * f), 2); updateTransform(); }

function resetView() {
    const vW = viewport.clientWidth;
    const vH = viewport.clientHeight;
    // سكيل ذكي للجوال: إذا كان العرض صغيراً، صغر الزوم تلقائياً لترى الخطة كاملة
    scale = vW < 600 ? (vW / 1500) : 0.7;
    translateX = 0;
    translateY = - (wrapper.offsetHeight * scale * 0.5) + (vH * 0.5) + header.offsetHeight + 20;
    updateTransform();
    drawConnections();
}

function drawConnections() {
  svg.innerHTML = `
    <defs>
      <marker id="arrow-pre" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto"><path d="M0,0 L8,4 L0,8 Z" fill="#38bdf8" /></marker>
      <marker id="arrow-co" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto"><path d="M0,0 L8,4 L0,8 Z" fill="#fbbf24" /></marker>
    </defs>`;
  svg.setAttribute('width', wrapper.scrollWidth);
  svg.setAttribute('height', wrapper.scrollHeight);
  const wrapRect = wrapper.getBoundingClientRect();

  connections.forEach(c => {
    const f = document.getElementById(c.from), t = document.getElementById(c.to);
    if(!f || !t) return;
    const r1 = f.getBoundingClientRect(), r2 = t.getBoundingClientRect();
    const x1 = (r1.left + r1.width/2 - wrapRect.left)/scale, y1 = (r1.bottom - wrapRect.top)/scale;
    const x2 = (r2.left + r2.width/2 - wrapRect.left)/scale, y2 = (r2.top - wrapRect.top)/scale;
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    let d;
    if(c.type==='co'){
        const cx1 = (r1.right - wrapRect.left)/scale, cy1 = (r1.top + r1.height/2 - wrapRect.top)/scale;
        const cx2 = (r2.left - wrapRect.left)/scale, cy2 = (r2.top + r2.height/2 - wrapRect.top)/scale;
        d = `M ${cx1} ${cy1} L ${cx1+15} ${cy1} L ${cx1+15} ${cy2} L ${cx2-5} ${cy2}`;
        path.setAttribute('stroke', '#fbbf24'); path.setAttribute('marker-end', 'url(#arrow-co)');
    } else {
        d = `M ${x1} ${y1} L ${x1} ${y1+(y2-y1)/2} L ${x2} ${y1+(y2-y1)/2} L ${x2} ${y2-5}`;
        path.setAttribute('stroke', '#38bdf8'); path.setAttribute('marker-end', 'url(#arrow-pre)');
    }
    path.setAttribute('d', d); path.setAttribute('fill', 'none'); path.setAttribute('stroke-width', '2'); path.setAttribute('opacity', '0.2');
    path.setAttribute('data-from', c.from); path.setAttribute('data-to', c.to);
    svg.appendChild(path);
  });
}

function initInteractions() {
  document.querySelectorAll('.card').forEach(card => {
    // دعم النقر المزدوج للجوال واللابتوب
    let lastTap = 0;
    card.addEventListener('touchend', e => {
        const now = Date.now();
        if(now - lastTap < 300) { card.classList.toggle('completed'); localStorage.setItem('ee_data', JSON.stringify(Array.from(document.querySelectorAll('.card.completed')).map(c=>c.id))); }
        lastTap = now;
    });
    card.addEventListener('dblclick', () => { card.classList.toggle('completed'); });

    card.addEventListener('click', e => {
      e.stopPropagation();
      if(card.classList.contains('selected')){ clearSelection(); return; }
      clearSelection();
      document.querySelectorAll('.card').forEach(c => c.style.opacity = '0.2');
      document.querySelectorAll('path').forEach(p => p.style.opacity = '0.05');
      card.style.opacity = '1'; card.classList.add('selected');
      document.querySelectorAll('path').forEach(p => {
        if(p.dataset.from===card.id || p.dataset.to===card.id){
            p.style.opacity = '1'; p.style.strokeWidth = '3';
            document.getElementById(p.dataset.from).style.opacity = '1';
            document.getElementById(p.dataset.to).style.opacity = '1';
        }
      });
    });
  });
  document.addEventListener('click', clearSelection);
}

function clearSelection() {
  document.querySelectorAll('.card').forEach(c => { c.style.opacity = '1'; c.classList.remove('selected'); });
  document.querySelectorAll('path').forEach(p => { p.style.opacity = '0.2'; p.style.strokeWidth = '2'; });
}

window.onload = () => { 
    resetView(); 
    initInteractions(); 
    const saved = localStorage.getItem('ee_data');
    if(saved) JSON.parse(saved).forEach(id => document.getElementById(id)?.classList.add('completed'));
    setTimeout(drawConnections, 300); 
};
window.onresize = resetView;
</script>
</body>
</html>
